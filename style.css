/*  Stewart / Figge — Acid-Base Calculator
 *  ─────────────────────────────────────────
 *  All visual styling for the single-page app.
 *  Uses CSS custom properties for dark/light theme switching.
 */

/* ═══════════════════════════════════════════════════════════
   §1  Design tokens (dark mode — default)
   ═══════════════════════════════════════════════════════════ */
/* -- Design tokens (dark) -- */
:root {
  --fg: #e6eef8; --muted: #9aa4b2; --gg-label: #9aa4b2;
  --accent: #60a5fa; --card: #0b1220;
  --border: rgba(255,255,255,0.06); --glass: rgba(255,255,255,0.03);
  --input-border: rgba(255,255,255,0.08); --tooltip-bg: rgba(2,6,23,0.92);

  /* Gamblegram palette — dark mode (default) */
  /* Cations (color‑blind friendly set) */
  --gg-Na:    #0052CC; /* Na⁺ */
  --gg-K:     #009E73; /* K⁺ */
  --gg-iCa:   #CC79A7; /* iCa²⁺ */
  --gg-Mg:    #56B4E9; /* Mg²⁺ */
  /* Anions (warm / high-contrast) */
  --gg-Cl:     #D55E00; /* Cl⁻ */
  --gg-Lactate:#E69F00; /* Lactate⁻ */
  --gg-HCO3:   #F0E442; /* HCO₃⁻ */
  --gg-Aminus: #F4B183; /* Albumin anionic contribution */
  --gg-Pi:     #F7E0A0; /* Phosphate */
  /* Unknown (distinct) */
  --gg-Unknown: #B347FF; /* Unknown / SIG (neon purple) */
}

/* ═══════════════════════════════════════════════════════════
   §2  Reset & body
   ═══════════════════════════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; }
html, body { height: 100%; }
body {
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  min-height: 100vh; line-height: 1.4; margin: 0;
  background: linear-gradient(180deg, #071029 0%, #071b2a 100%);
  color: var(--fg);
  display: flex; align-items: flex-start; justify-content: center;
  padding: 24px 16px 48px; overflow-y: auto;
}

/* ═══════════════════════════════════════════════════════════
   §3  Container card
   ═══════════════════════════════════════════════════════════ */
/* -- Container -- */
.container {
  position: relative; width: 100%; max-width: 780px;
  background: var(--card); border-radius: 12px; padding: 22px;
  margin: 0 auto; box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  border: 1px solid var(--border);
}
h1 { margin: 0 0 6px; font-size: 20px; }
h2 { margin: 0 0 8px; }
h3 { margin: 0; }
p.muted { color: var(--muted); margin: 6px 0 18px; }
.note { color: var(--muted); margin-top: 10px; font-size: 13px; }
footer { margin-top: 14px; color: var(--muted); font-size: 13px; }

/* ═══════════════════════════════════════════════════════════
   §4  Single-column layout
   ═══════════════════════════════════════════════════════════ */
/* -- Single-column stack -- */
section.grid { display: flex; flex-direction: column; gap: 14px; }

/* ═══════════════════════════════════════════════════════════
   §5  Fieldsets & inputs
   ═══════════════════════════════════════════════════════════ */
/* -- Fieldsets / inputs -- */
fieldset {
  background: var(--glass); border-radius: 8px; padding: 12px;
  border: 1px solid var(--border);
}
legend { font-weight: 600; color: var(--accent); }
label {
  display: flex; justify-content: space-between; align-items: center;
  padding: 6px 0; font-size: 16px; color: var(--fg);
}
input[type="number"] {
  width: 96px; height: 40px; background: transparent;
  border: 1px solid var(--input-border);
  padding: 8px 10px; border-radius: 6px; color: inherit; text-align: right;
  font-size: 16px;
}
input[disabled] { background: rgba(255,255,255,0.01); color: var(--muted); cursor: not-allowed; }
/* native select pickers (replace sliders) */
.picker { display: inline-block; min-width: 140px; margin-left: 8px; min-height: 40px; font-size: 16px; }


.ion-label { white-space: nowrap; display: inline-block; font-weight: 600; }
.ion-label sup, .ion-label sub,
.gg-legend .item sup, label sup { font-size: .72em; line-height: 1; vertical-align: super; margin-left: 0.05ch; }
.unit-select {
  margin-left: 8px; background: transparent;
  border: 1px solid var(--input-border); color: inherit;
  padding: 8px 10px; border-radius: 6px; font-size: 14px; min-height: 40px;
}
select.unit-select option { color: inherit; }
.checkbox-row { display: flex; align-items: center; gap: 12px; color: var(--muted); font-size: 16px; padding-top: 6px; }
.checkbox-row input { width: 20px; height: 20px; margin: 0; cursor: pointer; }
.small-note { font-size: 12px; color: var(--muted); margin-top: 6px; display: block; }

/* ═══════════════════════════════════════════════════════════
   §6  Toolbar (global toggles)
   ═══════════════════════════════════════════════════════════ */
/* -- Toolbar -- */
.toolbar { display: flex; gap: 14px; margin-bottom: 12px; align-items: center; flex-wrap: wrap; }
.toolbar label { color: var(--muted); font-size: 16px; display: flex; gap: 8px; align-items: center; }

/* ═══════════════════════════════════════════════════════════
   §7  Mobile header (hidden on desktop)
   ═══════════════════════════════════════════════════════════ */
/* -- Mobile header (hidden on desktop) -- */
.mobile-header {
  display: none; align-items: center; justify-content: space-between;
  gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); margin-bottom: 12px;
}
.mobile-header .mobile-title { font-weight: 800; color: var(--accent); font-size: 15px; white-space: nowrap; }
.mobile-header .mobile-summary { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.mobile-header .mh-item { color: var(--muted); font-weight: 700; font-size: 13px; }
.mobile-header .mobile-actions .compact {
  background: transparent; border: 1px solid var(--border);
  color: var(--muted); padding: 6px 8px; border-radius: 6px;
  cursor: pointer; font-size: 12px;
}

/* ═══════════════════════════════════════════════════════════
   §8  Results panel
   ═══════════════════════════════════════════════════════════ */
/* -- Results -- */
.results.compact {
  padding: 14px; background: rgba(255,255,255,0.02);
  border-radius: 8px; border: 1px solid rgba(255,255,255,0.02);
}
.results.compact dl { display: grid; grid-template-columns: 1fr 140px; gap: 8px; align-items: center; }
.results.compact dt { font-size: 15px; color: var(--muted); }
.results.compact dd { font-size: 18px; margin: 0; font-weight: 800; text-align: right; }
.results-actions { margin-top: 10px; display: flex; justify-content: flex-end; gap: 8px; flex-wrap: wrap; }
.results-actions button {
  background: transparent; border: 1px solid var(--border);
  color: var(--muted); padding: 12px 16px; border-radius: 6px;
  cursor: pointer; font-size: 14px; min-height: 44px;
}

/* ═══════════════════════════════════════════════════════════
   §9  Gamblegram (SVG stacked bars)
   ═══════════════════════════════════════════════════════════ */
/* -- Gamblegram -- */
.gamblegram {
  padding: 16px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 8px; border: 1px solid rgba(255,255,255,0.03);
}
.gamblegram h2 { margin: 0 0 8px; color: var(--accent); }
.gg-canvas { display: flex; justify-content: center; align-items: flex-start; max-height: min(1500px, 95vh); }
svg#gg-svg { width: 100%; height: auto; display: block; transition: opacity 240ms ease; touch-action: none; }
svg text.gg-val { fill: var(--gg-label); font-weight: 400; pointer-events: none; }
svg text.gg-name { fill: var(--gg-label); font-weight: 400; pointer-events: none; }
.gg-info { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-top: 8px; }
.gg-legend { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
.gg-legend .item { display: flex; gap: 6px; align-items: center; color: var(--muted); font-size: 14px; line-height: 1.4; }
.gg-legend .swatch {
  width: 12px; height: 12px; border-radius: 3px; display: inline-block;
  border: 1px solid rgba(255,255,255,0.06); box-shadow: 0 6px 18px rgba(2,6,23,0.45);
}
.gg-unknown { margin-top: 8px; font-weight: 700; color: #ffd166; }

/* ═══════════════════════════════════════════════════════════
   §10  Tooltip
   ═══════════════════════════════════════════════════════════ */
/* -- Tooltip -- */
.gg-tooltip {
  position: absolute; pointer-events: none; padding: 10px 12px;
  border-radius: 8px; background: var(--tooltip-bg); color: var(--fg);
  font-size: 14px; border: 1px solid var(--border);
  transform: translate(-50%, -110%); white-space: nowrap; z-index: 40;
  box-shadow: 0 6px 30px rgba(2,6,23,0.6);
  opacity: 0; transition: opacity 120ms ease, transform 120ms ease;
}
.gg-tooltip.visible { opacity: 1; transform: translate(-50%, -120%) scale(1); }

/* ═══════════════════════════════════════════════════════════
   §11  Formulas panel (collapsible)
   ═══════════════════════════════════════════════════════════ */
/* -- Formulas / collapsible -- */
.formulas { margin-top: 4px; }
.formulas-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; gap: 10px; }
.collapse-btn {
  background: transparent; border: 1px solid var(--border);
  color: var(--muted); padding: 10px 14px; border-radius: 6px;
  cursor: pointer; font-size: 14px; flex-shrink: 0; min-height: 40px;
}
.formulas.collapsed .formulas-body { display: none; }

/* Formulas body: let MathJax lay out naturally; scrollable if wide */
.formulas-body { overflow-x: auto; padding-bottom: 4px; }
.formulas-body pre { white-space: normal; overflow-wrap: anywhere; }

/* ═══════════════════════════════════════════════════════════
   §12  SVG interactivity (hover / focus effects)
   ═══════════════════════════════════════════════════════════ */
/* -- Gamblegram interactivity -- */
svg rect.gg-rect { transition: transform 160ms ease, filter 160ms ease, stroke 160ms ease, fill-opacity 160ms ease; }
svg rect.gg-rect:hover, svg rect.gg-rect:focus {
  transform: translateY(-3px); filter: brightness(1.03);
  stroke: rgba(0,0,0,0.12); stroke-width: 1.2; cursor: pointer; outline: none;
}

/* Focused mode: dim / hollow out all regions except the active one */
svg.focused rect.gg-rect { /* when any segment selected, switch to focused mode */ fill-opacity: 1; opacity: 1; filter: none; }
svg.focused rect.gg-rect:not(.active) {
  /* non-active segments: keep a faint tint + thicker outline so the original colors remain readable */
  fill-opacity: 0.12; /* faint colour hint */
  stroke: rgba(255,255,255,0.24); /* stronger outline on dark theme */
  stroke-width: 2; /* thicker outline for visibility */
  opacity: 0.98;
  transform: none; filter: none; transition: stroke 160ms ease, fill-opacity 160ms ease, opacity 160ms ease;
}
svg rect.gg-rect.active {
  /* active segment is visually emphasized and remains filled */
  transform: translateY(-4px); filter: brightness(1.04); stroke: rgba(0,0,0,0.12); stroke-width: 1.6; opacity: 1; fill-opacity: 0.95;
}

/* Unknown segment: make visually distinct (neon‑purple accent + glow) */
svg rect.gg-rect[data-key="Unknown"] {
  stroke: var(--gg-Unknown);
  stroke-width: 2.8;
  /* soft glow matching the neon accent */
  filter: drop-shadow(0 8px 18px rgba(179,71,255,0.20)) drop-shadow(0 0 8px rgba(179,71,255,0.12));
}

/* Slightly different outline on light theme for better contrast */
body.light svg.focused rect.gg-rect:not(.active) {
  stroke: rgba(0,0,0,0.18);
  stroke-width: 1.6;
}


/* ═══════════════════════════════════════════════════════════
   §13  Mobile breakpoint (≤ 520 px)
   ═══════════════════════════════════════════════════════════ */
/* -- Mobile (<=520px) -- */
@media (max-width: 520px) {
  body { padding: 10px 8px 32px; font-size: 16px; }
  .container { padding: 14px; border-radius: 8px; }
  .mobile-header { display: flex; }
  h1 { font-size: 20px; }
  label { font-size: 16px; }
  label .ion-label { font-weight: 700; }
  .gg-canvas { height: 66vh; max-height: 66vh; }
  input[type="number"] { width: 100%; font-size: 16px; }
  .unit-select { margin-left: 0; align-self: flex-start; font-size: 14px; }
  /* visible mobile pickers */
  .picker { display: block; width: 100%; margin-top: 8px; font-size: 16px; }
  .picker { -webkit-appearance: menulist-button; appearance: menulist-button; }
  .picker:focus { outline: 2px solid var(--accent); outline-offset: 2px; }

  .results.compact dl { grid-template-columns: 1fr 110px; }
  .results.compact dt { font-size: 16px; }
  .results.compact dd { font-size: 18px; }
  .results-actions { justify-content: stretch; }
  .results-actions button { flex: 1; text-align: center; font-size: 14px; }
  .gg-legend .item { font-size: 14px; }
  .small-note { font-size: 14px; }
}

/* ═══════════════════════════════════════════════════════════
   §14  Light-mode overrides
   ═══════════════════════════════════════════════════════════ */
/* -- Light mode -- */
body.light {
  background: linear-gradient(180deg, #f6f8fb 0%, #eef3f7 100%);
  color: #0b1220;
  --fg: #111827; --muted: #6b7280; --gg-label: #374151;
  --accent: #1d4ed8; --card: #ffffff;
  --border: rgba(2,6,23,0.08); --glass: rgba(0,0,0,0.02);
  --input-border: rgba(0,0,0,0.12); --tooltip-bg: rgba(255,255,255,0.98);

  /* Gamblegram palette — light mode overrides */
  /* Cations (color‑blind friendly set) */
  --gg-Na:    #0052CC; /* Na⁺ */
  --gg-K:     #009E73; /* K⁺ */
  --gg-iCa:   #CC79A7; /* iCa²⁺ */
  --gg-Mg:    #56B4E9; /* Mg²⁺ */
  /* Anions (warm / high-contrast) */
  --gg-Cl:     #D55E00; /* Cl⁻ */
  --gg-Lactate:#E69F00; /* Lactate⁻ */
  --gg-HCO3:   #F0E442; /* HCO₃⁻ */
  --gg-Aminus: #F4B183; /* Albumin anionic contribution */
  --gg-Pi:     #F7E0A0; /* Phosphate */
  /* Unknown (distinct) */
  --gg-Unknown: #B347FF; /* Unknown / SIG (neon purple) */
}
body.light .container {
  background: var(--card); color: var(--fg);
  border: 1px solid var(--border); box-shadow: 0 6px 26px rgba(2,6,23,0.04);
}
body.light input[type="number"] { color: var(--fg); }
body.light input::placeholder { color: #9ca3af; }
body.light .gg-legend .swatch { border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
body.light .gg-tooltip { color: #111; }

/* ── References section ── */
.references { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border); }
.references h3 { font-size: 0.95rem; margin: 0 0 0.6rem; color: var(--accent); }
.references ol { padding-left: 1.4rem; margin: 0; font-size: 0.82rem; line-height: 1.55; color: var(--muted); }
.references li + li { margin-top: 0.35rem; }
.references cite { font-style: italic; }
.references a { color: var(--accent); text-decoration: none; }
.references a:hover { text-decoration: underline; }
